<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Horse Odds Calculator</title>
  <link rel="icon" href="favicon.ico" />
</head>
<body>
  <header>
    <h1>Horse Odds Calculator</h1>
  </header>

  <div class="container">
    <!-- üîê Auth Form -->
    <div class="auth-container">
      <input type="email" id="email" placeholder="Email" />
      <input type="password" id="password" placeholder="Password" />
      <button onclick="signUp()">Sign Up</button>
      <button onclick="signIn()">Sign In</button>
      <button onclick="signOut()">Sign Out</button>
    </div>
    <p id="authStatus">üîí Not signed in</p>

    <!-- üéØ Bet Form -->
    <label for="betMode">Select Bet Type:</label>
    <select id="betMode">
      <option value="win">Win</option>
      <option value="place">Place</option>
      <option value="show">Show</option>
      <option value="exacta">Exacta</option>
      <option value="exacta_box">Exacta Box</option>
      <option value="trifecta">Trifecta</option>
      <option value="trifecta_box">Trifecta Box</option>
      <option value="trifecta_key">Trifecta Key</option>
      <option value="superfecta">Superfecta</option>
      <option value="daily_double">Daily Double</option>
      <option value="pick3">Pick 3</option>
      <option value="pick4">Pick 4</option>
      <option value="pick5">Pick 5</option>
      <option value="pick6">Pick 6</option>
    </select>

    <label for="betAmount">Bet Amount ($):</label>
    <input type="number" id="betAmount" min="0.5" step="0.1" placeholder="e.g. 2.00" />

    <label for="oddsInput">Enter Odds (e.g., 9/5):</label>
    <input type="text" id="oddsInput" placeholder="e.g. 9/5" />

    <label for="trackInput">Track Code:</label>
    <input type="text" id="trackInput" value="BEL" />

    <label for="raceDate">Race Date:</label>
    <input type="date" id="raceDate" value="2025-07-25" />

    <button type="button" onclick="calculateOdds()">Calculate</button>
    <button type="button" onclick="fetchPayoutDataFromInputs()">üîç Fetch Live Odds</button>
    <button type="button" onclick="shareBet()">üîó Share This Bet</button>

    <div class="result" id="result"></div>
    <p id="betInfo"></p>
  </div>

  <!-- üî• Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    // ‚úÖ Your Firebase Config ‚Äî replace with your actual keys
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // üîê Auth logic
    function signUp() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      auth.createUserWithEmailAndPassword(email, password)
        .then(() => alert("‚úÖ Signed up"))
        .catch(err => alert("‚ùå " + err.message));
    }

    function signIn() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      auth.signInWithEmailAndPassword(email, password)
        .then(user => document.getElementById("authStatus").innerText = `üîì Logged in as ${email}`)
        .catch(err => alert("‚ùå " + err.message));
    }

    function signOut() {
      auth.signOut()
        .then(() => document.getElementById("authStatus").innerText = "üîí Signed out")
        .catch(err => alert("‚ùå " + err.message));
    }

    function calculateOdds() {
      const betType = document.getElementById('betMode').value;
      const betAmount = parseFloat(document.getElementById('betAmount').value);
      const oddsInput = document.getElementById('oddsInput').value;
      const resultDiv = document.getElementById('result');
      const betInfoDiv = document.getElementById('betInfo');

      if (!betAmount || !oddsInput.includes('/')) {
        resultDiv.innerHTML = "‚ùå Enter a valid bet amount and odds (e.g. 5/2)";
        betInfoDiv.innerHTML = "";
        return;
      }

      const [num, denom] = oddsInput.split('/').map(Number);
      const decimalOdds = num / denom;

      const multiplierMap = {
        win: 1,
        place: 0.5,
        show: 0.33,
        exacta: 2,
        exacta_box: 2.4,
        trifecta: 3,
        trifecta_box: 6,
        trifecta_key: 3,
        superfecta: 4,
        daily_double: 2,
        pick3: 3,
        pick4: 4,
        pick5: 5,
        pick6: 6
      };

      const descriptions = {
        exacta_box: "Boxing 2 horses = 2 combinations (1-2, 2-1)",
        trifecta_box: "Boxing 3 horses = 6 combinations",
        trifecta_key: "Keying 1 horse with 2 others = 3 combinations",
        daily_double: "Pick winners of 2 races",
        pick3: "Pick winners of 3 races",
        pick4: "Pick winners of 4 races",
        pick5: "Pick winners of 5 races",
        pick6: "Pick winners of 6 races"
      };

      const multiplier = multiplierMap[betType] || 1;
      const grossProfit = betAmount * decimalOdds * multiplier;
      const totalReturn = betAmount + grossProfit;
      const breakEvenOdds = (1 / multiplier).toFixed(2);
      const profitOrLoss = grossProfit <= 0 ? 'üî¥ Loss' : 'üü¢ Profit';
      const warning = grossProfit < 0.5 ? "‚ö†Ô∏è Odds may be too low to profit from this wager." : "";

      resultDiv.innerHTML = `
        üí∏ Type: <b>${betType}</b><br>
        üìä Decimal Odds: <b>${decimalOdds.toFixed(2)}</b><br>
        üí∞ Gross Profit: <b>$${grossProfit.toFixed(2)}</b><br>
        üíµ Total Return: <b>$${totalReturn.toFixed(2)}</b><br>
        üìà Break-even Odds: <b>${breakEvenOdds}</b><br>
        ‚úÖ ${profitOrLoss}<br>
        ${warning}
      `;

      betInfoDiv.innerText = descriptions[betType] || "";

      logBetToFirestore({
        betType,
        amount: betAmount,
        odds: oddsInput,
        profit: grossProfit.toFixed(2),
        total: totalReturn.toFixed(2),
        timestamp: new Date(),
      });
    }

    function fetchPayoutDataFromInputs() {
      const track = document.getElementById('trackInput').value;
      const date = document.getElementById('raceDate').value;
      const odds = ["5/2", "9/5", "3/1"][Math.floor(Math.random() * 3)];
      document.getElementById('oddsInput').value = odds;
      alert(`üì° Loaded odds for ${track} on ${date}: ${odds}`);
    }

    function shareBet() {
      const bet = document.getElementById('betMode').value;
      const amount = document.getElementById('betAmount').value;
      const odds = document.getElementById('oddsInput').value;
      const shareURL = `${window.location.origin}${window.location.pathname}?bet=${bet}&amount=${amount}&odds=${odds}`;
      navigator.clipboard.writeText(shareURL)
        .then(() => alert('‚úÖ Link copied to clipboard!'))
        .catch(() => alert('üîó Share this link:\n' + shareURL));
    }

    function logBetToFirestore(data) {
      db.collection("bets").add(data)
        .then(() => console.log("üì§ Bet logged"))
        .catch((error) => console.error("‚ùå Firestore error:", error));
    }
  </script>
</body>
</html>
